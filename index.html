<!doctype html>
<html lang="hr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Yr Widget – traži po nazivu</title>
<style>
 body{font-family:sans-serif;background:#f7fbff;margin:20px}
 .card{max-width:800px;margin:auto;background:#fff;padding:20px;border-radius:12px;box-shadow:0 4px 15px rgba(0,0,0,.1)}
 label{font-weight:600;margin-top:10px;display:block}
 input,select{width:100%;padding:8px;margin-top:4px;border:1px solid #ccc;border-radius:6px}
 #results{border:1px solid #ccc;border-top:none;border-radius:0 0 6px 6px;display:none;max-height:180px;overflow:auto;background:#fff}
 #results div{padding:6px 10px;cursor:pointer}
 #results div:hover{background:#eef3f9}
 iframe{width:100%;border:0;margin-top:14px;border-radius:8px;min-height:260px}
 footer{font-size:0.8rem;margin-top:10px;color:#555}
</style>
</head>
<body>
<div class="card">
  <h2>Prognoza (yr.no) – traži mjesto</h2>

  <label for="place">Naziv mjesta:</label>
  <input type="text" id="place" placeholder="npr. Zagreb, Split, Oslo" autocomplete="off">
  <div id="results"></div>

  <label for="forecast">Tip prognoze:</label>
  <select id="forecast">
    <option value="table">Dnevno / dugoročno (table)</option>
    <option value="meteogram">Satna (meteogram)</option>
    <option value="card">Kratki prikaz (card 24h)</option>
  </select>

  <iframe id="widget" title="YR widget"></iframe>

  <footer>Weather data and widgets from Yr (Meteorologisk institutt). Data licensed under NLOD 2.0 and CC BY 4.0.</footer>
</div>

<script>
const placeInput = document.getElementById('place');
const resultsBox = document.getElementById('results');
const forecastSel = document.getElementById('forecast');
const iframe = document.getElementById('widget');

const pattern = {
  meteogram: (lat,lon)=>`https://www.yr.no/en/content/${lat},${lon}/meteogram.svg`,
  table:     (lat,lon)=>`https://www.yr.no/en/content/${lat},${lon}/table.html`,
  card:      (lat,lon)=>`https://www.yr.no/en/content/${lat},${lon}/card.html`
};

let timer, currentCoords=null;

placeInput.addEventListener('input', ()=>{
  clearTimeout(timer);
  const q=placeInput.value.trim();
  if(!q){resultsBox.style.display='none';return;}
  timer=setTimeout(()=>searchPlace(q),400);
});

async function searchPlace(q){
  try{
    const url=`https://nominatim.openstreetmap.org/search?format=json&limit=8&q=${encodeURIComponent(q)}`;
    const res=await fetch(url,{
      headers:{'User-Agent':'yr-widget-demo/1.0 (kontakt: youremail@example.com)'}
    });
    const data=await res.json();
    showResults(data);
  }catch(e){console.error(e);}
}

function showResults(list){
  resultsBox.innerHTML='';
  if(!list.length){resultsBox.style.display='none';return;}
  list.forEach(item=>{
    const d=document.createElement('div');
    d.textContent=item.display_name;
    d.onclick=()=>selectLocation(item.lat,item.lon,item.display_name);
    resultsBox.appendChild(d);
  });
  resultsBox.style.display='block';
}

function selectLocation(lat,lon,label){
  currentCoords={lat,lon};
  placeInput.value=label;
  resultsBox.style.display='none';
  updateWidget();
}

forecastSel.addEventListener('change',updateWidget);

function updateWidget(){
  if(!currentCoords) return;
  const t=forecastSel.value;
  iframe.src=pattern[t](currentCoords.lat,currentCoords.lon);
  if(t==='meteogram') iframe.style.height='420px';
  else if(t==='card') iframe.style.height='260px';
  else iframe.style.height='520px';
}
</script>
</body>
</html>
